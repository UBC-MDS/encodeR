<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An Introduction to encodeR • encodeR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="An Introduction to encodeR">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">encodeR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/encodeR-vignette.html">An Introduction to encodeR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/UBC-MDS/encodeR">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>An Introduction to encodeR</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/UBC-MDS/encodeR/blob/master/vignettes/encodeR-vignette.Rmd"><code>vignettes/encodeR-vignette.Rmd</code></a></small>
      <div class="hidden name"><code>encodeR-vignette.Rmd</code></div>

    </div>

    
    
<p>The <strong>encodeR</strong> package contains functions that allow for more elegant and informative encodings of <a href="https://en.wikipedia.org/wiki/Categorical_variable">categorical features</a>. This package uses a large variety of R packages that need to be installed. These packages are:</p>
<ul>
<li>dplyr</li>
<li>readr</li>
<li>rlang</li>
<li>tidyr</li>
<li>fastDummies</li>
<li>purrr</li>
<li>tidyselect</li>
<li>magrittr</li>
</ul>
<p>Currently, this package is not available on CRAN. However, one can install the development version of this package by running:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">devtools<span class="op">::</span><span class="kw"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_github</a></span>(<span class="st">"UBC-MDS/encodeR"</span>)</a></code></pre></div>
<p>The website for this package can be found <a href="link">here.</a></p>
<p><strong>encodeR</strong> has four functions that implement different kinds of encodings for categorical features. Many of these functions take advantage of the response/target variable, y, to create more informative representations. Currently, <strong>encodeR</strong> only supports the tasks of binary classification and regression.</p>
<p>In most cases, preprocessing of these features is often done using a relatively simple method such as one hot encoding. While this can achieve satisfactory results, often there are better, more <em>sparse</em> representations of these features. These more accurate and sparse representations often come with the drawback of being tedious to implement, but <strong>encodeR</strong> allows one to easily fit such encodings all with a common interface.</p>
<div id="target-encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#target-encoding" class="anchor"></a>Target Encoding</h2>
<p>One encoding method that has become popular in recent years is that of target encoding. Target encoding essentially uses the average observed response per each category to derive encodings for each category.</p>
<p>First, load the mtcars dataset.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(encodeR)))</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/message.html">suppressMessages</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/warning.html">suppressWarnings</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)))</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">mtcars_data &lt;-<span class="st"> </span>mtcars</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(mtcars_data)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;                    mpg cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt; Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
<p>Suppose the user wishes to encode the <code>cyl</code> and the <code>vs</code> columns, which have three (4, 6 and 8 cylinders) and two categories (0 or 1) respectively. Assume further that the user wishes to predict the variable <code>mpg</code>.</p>
<p>Then, all that is left to do is to call the function <code>target_encoder</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">frame_with_encodings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/target_encoder.html">target_encoder</a></span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">X_train =</span> mtcars_data,</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">y =</span> mtcars<span class="op">$</span>mpg,</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>, <span class="st">"vs"</span>),</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">  <span class="dt">prior =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">  <span class="dt">objective =</span> <span class="st">"regression"</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">)</a>
<a class="sourceLine" id="cb3-9" data-line-number="9"></a>
<a class="sourceLine" id="cb3-10" data-line-number="10"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(frame_with_encodings<span class="op">$</span>train)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"><span class="co">#&gt;    mpg      cyl disp  hp drat    wt  qsec       vs am gear carb</span></a>
<a class="sourceLine" id="cb3-12" data-line-number="12"><span class="co">#&gt; 1 21.0 19.74286  160 110 3.90 2.620 16.46 16.61667  1    4    4</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="co">#&gt; 2 21.0 19.74286  160 110 3.90 2.875 17.02 16.61667  1    4    4</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="co">#&gt; 3 22.8 26.66364  108  93 3.85 2.320 18.61 24.55714  1    4    1</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="co">#&gt; 4 21.4 19.74286  258 110 3.08 3.215 19.44 24.55714  0    3    1</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="co">#&gt; 5 18.7 15.10000  360 175 3.15 3.440 17.02 16.61667  0    3    2</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="co">#&gt; 6 18.1 19.74286  225 105 2.76 3.460 20.22 24.55714  0    3    1</span></a></code></pre></div>
<p>The user must specify <code>X_train</code>, which is a tibble, a response variable <code>y</code> which is a vector, and a character vector containing the names of the categorical columns the user wishes to encode. The user must also set the objective to “regression” here since the response variable is fully continuous.</p>
<p>Observe that both the <code>cyl</code> and the <code>vs</code> columns have been replaced with fully numeric columns. An important fact to note is that the resulting tibble is that of the original dimension - in fact, there are no additional columns added after the encoding process. This is one reason why target encoding (as well as others) are effective. They do not increase the dimension of the data, which <a href="https://en.wikipedia.org/wiki/Curse_of_dimensionality">can often lead to problems.</a></p>
<p>Either way, these new columns correspond to the learned encodings of the various categories. For example, for <code>cyl</code>, the encodings are:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">frame_with_encodings<span class="op">$</span>train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="dt">cyl_orig =</span> mtcars_data<span class="op">$</span>cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt;        cyl cyl_orig</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co">#&gt; 1 19.74286        6</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co">#&gt; 2 26.66364        4</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co">#&gt; 3 15.10000        8</span></a></code></pre></div>
<p>The encodings for each category are fairly intuitive here. Recall that the target variable is <code>mpg</code>. Thus, one can easily see that as the number of cylinders increases, the mpg decreases. This relationship is now captured in the encodings.</p>
<div id="the-argument-x_test" class="section level3">
<h3 class="hasAnchor">
<a href="#the-argument-x_test" class="anchor"></a>The argument X_test</h3>
<p>Often, the user splits the entire dataset into two before doing any preprocessing of the features, to prevent overfitting and to ensure an honest assessment of model performance. Preprocessing features before splitting may lead to information being leaked from the test set.</p>
<p>Encodings are no exception to this rule. For more common methods such as one hot encoding, users typically do not need to worry about information leakage since each row is still treated independently of all others. However, for target encoding and conjugate encoding it is vital that the dataset is split before since these methods average over multiple rows and also involve the response/target variable.</p>
<p>The <strong>encodeR</strong> package has been designed so that the user does not need to worry about any potential data leakage. The encodings are learned strictly on <code>X_train</code> and are then joined to <code>X_test</code>.</p>
<p>The user can easily do this by supplying an <em>optional</em> argument to <code>X_test</code> to any of the encoding functions like so:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">mtcars_train &lt;-<span class="st"> </span>mtcars[<span class="dv">1</span><span class="op">:</span><span class="dv">30</span>, ]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">mtcars_test &lt;-<span class="st"> </span>mtcars[<span class="dv">31</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(mtcars), ]</a>
<a class="sourceLine" id="cb5-4" data-line-number="4"></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">my_encodings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/target_encoder.html">target_encoder</a></span>(</a>
<a class="sourceLine" id="cb5-6" data-line-number="6">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb5-7" data-line-number="7">  <span class="dt">X_test =</span> mtcars_test,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  <span class="dt">y =</span> mtcars_train<span class="op">$</span>mpg, </a>
<a class="sourceLine" id="cb5-9" data-line-number="9">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">  <span class="dt">prior =</span> <span class="fl">0.7</span>,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">  <span class="dt">objective =</span> <span class="st">"regression"</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12">)</a>
<a class="sourceLine" id="cb5-13" data-line-number="13"></a>
<a class="sourceLine" id="cb5-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(my_encodings<span class="op">$</span>train)</a>
<a class="sourceLine" id="cb5-15" data-line-number="15"><span class="co">#&gt;    mpg      cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb5-16" data-line-number="16"><span class="co">#&gt; 1 21.0 19.78593  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb5-17" data-line-number="17"><span class="co">#&gt; 2 21.0 19.78593  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb5-18" data-line-number="18"><span class="co">#&gt; 3 22.8 26.73380  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb5-19" data-line-number="19"><span class="co">#&gt; 4 21.4 19.78593  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb5-20" data-line-number="20"><span class="co">#&gt; 5 18.7 15.36873  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb5-21" data-line-number="21"><span class="co">#&gt; 6 18.1 19.78593  225 105 2.76 3.460 20.22  1  0    3    1</span></a>
<a class="sourceLine" id="cb5-22" data-line-number="22">my_encodings<span class="op">$</span>test</a>
<a class="sourceLine" id="cb5-23" data-line-number="23"><span class="co">#&gt;    mpg      cyl disp  hp drat   wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb5-24" data-line-number="24"><span class="co">#&gt; 1 15.0 15.36873  301 335 3.54 3.57 14.6  0  1    5    8</span></a>
<a class="sourceLine" id="cb5-25" data-line-number="25"><span class="co">#&gt; 2 21.4 26.73380  121 109 4.11 2.78 18.6  1  1    4    2</span></a></code></pre></div>
<p>Observe that the encoder function now returns a list with two tibbles labelled <code>train</code> and <code>test</code>. The two tibbles returned contain the preprocessed <code>X_train</code> and <code>X_test</code> tibbles, respectively.</p>
<p>Note that when using <code>target_encoder</code> that if there are categories that do not appear in the training set but do appear in the test set, these categories are encoded with the group mean (see below) <span class="math inline">\(\bar x\)</span> of the target variable.</p>
</div>
<div id="the-prior-parameter" class="section level3">
<h3 class="hasAnchor">
<a href="#the-prior-parameter" class="anchor"></a>The Prior Parameter</h3>
<p>Target encoding is highly susceptible to overfitting since the estimated relationship between the categories in the training set may not necessarily be true in general.</p>
<p>The <code>prior</code> paramter in <code>target_encoding</code> allows us to address this issue through the use of Laplace smoothing. The idea of Laplace smoothing is to use a weighted average of the mean of the response variable and the conditional mean per each category. The result is a smoothed estimate that, with a suitable <code>prior</code> chosen, is less prone to overfitting. Formally, the learned encoding for the jth category <span class="math inline">\(u_{j}\)</span> is now:</p>
<p><span class="math display">\[u_{j} = \frac{\sum_{i=1}^{N} y_{ij} + \text{prior} \times \bar x}{N + \text{prior}},\]</span> where <span class="math inline">\(\bar x\)</span> is the mean of the response, and <span class="math inline">\(N\)</span> is the total number of observations belogning to category <span class="math inline">\(j\)</span>. Thus, a larger <code>prior</code> parameter places more weight on the group mean <span class="math inline">\(\bar x\)</span>, whereas a lower prior fully trusts the data.</p>
<p>If one repeats the example above but with a prior of 5:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">frame_with_encodings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/target_encoder.html">target_encoder</a></span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">y =</span> mtcars_train<span class="op">$</span>mpg,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>),</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">prior =</span> <span class="dv">5</span>,</a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  <span class="dt">objective =</span> <span class="st">"regression"</span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb6-8" data-line-number="8"></a>
<a class="sourceLine" id="cb6-9" data-line-number="9">frame_with_encodings<span class="op">$</span>train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="dt">cyl_orig =</span> mtcars_train<span class="op">$</span>cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()</a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="co">#&gt;        cyl cyl_orig</span></a>
<a class="sourceLine" id="cb6-14" data-line-number="14"><span class="co">#&gt; 1 19.94028        6</span></a>
<a class="sourceLine" id="cb6-15" data-line-number="15"><span class="co">#&gt; 2 24.86556        4</span></a>
<a class="sourceLine" id="cb6-16" data-line-number="16"><span class="co">#&gt; 3 16.52685        8</span></a></code></pre></div>
<p>Observe that the encodings for 6 and 8 cylinders have been dragged slightly up, whereas the encodings for 4 cylinders has been dragged down. This is because 6 and 8 cylinder vehicles have lower than average miles per gallon, whereas 4 cylinder vehicles have higher than average miles per gallon.</p>
</div>
</div>
<div id="frequency-encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#frequency-encoding" class="anchor"></a>Frequency Encoding</h2>
<p>Another more recently popular method of encoding (especially in Kaggle competitions) is that of frequency encoding. Frequency encoding derives its encodings by using the observed frequency of each class. The intuition behind such an encoding is that those categories that appear the most should be assigned higher weight than those that do not.</p>
<p>The usage of the function <code>frequency_encoder</code> is straightforward. Note that this function does not require a <code>y</code> or <code>objective</code> argument, because it does not make use of the response/target when deriving its encodings.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"></a>
<a class="sourceLine" id="cb7-2" data-line-number="2">encodings_freq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/frequency_encoder.html">frequency_encoder</a></span>(</a>
<a class="sourceLine" id="cb7-3" data-line-number="3">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb7-4" data-line-number="4">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5">)</a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(encodings_freq<span class="op">$</span>train)</a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;                    mpg       cyl disp  hp drat    wt  qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt; Mazda RX4         21.0 0.2333333  160 110 3.90 2.620 16.46  0  1    4    4</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt; Mazda RX4 Wag     21.0 0.2333333  160 110 3.90 2.875 17.02  0  1    4    4</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt; Datsun 710        22.8 0.3333333  108  93 3.85 2.320 18.61  1  1    4    1</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt; Hornet 4 Drive    21.4 0.2333333  258 110 3.08 3.215 19.44  1  0    3    1</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt; Hornet Sportabout 18.7 0.4333333  360 175 3.15 3.440 17.02  0  0    3    2</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; Valiant           18.1 0.2333333  225 105 2.76 3.460 20.22  1  0    3    1</span></a></code></pre></div>
<p>We see that the <code>cyl</code> column has been replaced by the learned frequencies of each category, as expected.</p>
<p>Note that currently, this function does not implement Laplace smoothing like in <code>target_encoder</code>. Thus, observations that do not appear in the train set but do appear in the test are given 0 frequencies.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">no_<span class="dv">8</span> &lt;-<span class="st"> </span>mtcars_train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(cyl <span class="op">!=</span><span class="st"> </span><span class="dv">8</span>)</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">encodings_freq &lt;-<span class="st"> </span><span class="kw"><a href="../reference/frequency_encoder.html">frequency_encoder</a></span>(</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="dt">X_train =</span> no_<span class="dv">8</span>,</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  <span class="dt">X_test =</span> mtcars_test,</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>)</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"></a>
<a class="sourceLine" id="cb8-13" data-line-number="13">encodings_freq<span class="op">$</span>test</a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="co">#&gt;                mpg       cyl disp  hp drat   wt qsec vs am gear carb</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="co">#&gt; Maserati Bora 15.0 0.0000000  301 335 3.54 3.57 14.6  0  1    5    8</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16"><span class="co">#&gt; Volvo 142E    21.4 0.5882353  121 109 4.11 2.78 18.6  1  1    4    2</span></a></code></pre></div>
<p>Observe now that for the Maserati Bora, the encoding is 0 since no other cars with 8 cylinders existed in the dataset.</p>
</div>
<div id="conjugate-encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#conjugate-encoding" class="anchor"></a>Conjugate Encoding</h2>
<p>This method for encoding categorical features is based on a <a href="https://arxiv.org/pdf/1904.13001.pdf">very recent paper</a> by Slakey et al. (2019). At a very high level, this paper reworks target encoding in a full Bayesian framework so that each category in a particular column has a posterior distribution using the response as the observed data. The first k moments of the posterior distributions are then used as the encodings.</p>
<p>The paper only discusses the use of this method through <a href="https://en.wikipedia.org/wiki/Conjugate_prior">conjugate priors</a> for computational reasons, but in theory any arbitrary prior and likelihood can be used.</p>
<p>To use this method, one must specify prior parameters depending on the objective to the argument <code>prior_params</code>. In the <code>objective = "regression"</code> case, the list must have four named items: mu, vega, alpha, and beta, which correspond to the parameters of a <a href="https://en.wikipedia.org/wiki/Normal-inverse-gamma_distribution">Normal-Inverse-gamma distribution</a>. Vega, alpha, and beta must all be greater than 0. mu can be any real number.</p>
<p>Using the function <code>conjugate_encoder</code> is relatively straightforward:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">prior_values &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">mu =</span> <span class="dv">0</span>, <span class="dt">vega =</span> <span class="dv">3</span>, <span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">beta =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">encodings_conjugate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/conjugate_encoder.html">conjugate_encoder</a></span>(</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">  <span class="dt">X_test =</span> mtcars_test,</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">  <span class="dt">y =</span> mtcars_train<span class="op">$</span>mpg,</a>
<a class="sourceLine" id="cb9-7" data-line-number="7">  <span class="dt">prior_params =</span> prior_values,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>),</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">  <span class="dt">objective =</span> <span class="st">"regression"</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"></a>
<a class="sourceLine" id="cb9-15" data-line-number="15">encodings_conjugate<span class="op">$</span>train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cyl_encoded_mean, cyl_encoded_var) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="dt">cyl =</span> mtcars_train<span class="op">$</span>cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb9-18" data-line-number="18"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()</a>
<a class="sourceLine" id="cb9-19" data-line-number="19"><span class="co">#&gt;   cyl_encoded_mean cyl_encoded_var cyl</span></a>
<a class="sourceLine" id="cb9-20" data-line-number="20"><span class="co">#&gt; 1         17.94805        37.61411   6</span></a>
<a class="sourceLine" id="cb9-21" data-line-number="21"><span class="co">#&gt; 2         24.71818        86.48751   4</span></a>
<a class="sourceLine" id="cb9-22" data-line-number="22"><span class="co">#&gt; 3         13.73427        27.91508   8</span></a></code></pre></div>
<p>As one can see, the encodings are fairly similar to that of <code>target_encoder</code> but with more flexibility via. the explicit modelling of the posterior.</p>
<p>Note that the Normal-Inverse-gamma distribution is bivariate. In other words, we assumed that the likelihood has unknown mean and unknown variance.</p>
<p>In general, the Normal-Inverse-gamma distribution is parameterized such that the density is a function of two random variables, <span class="math inline">\(f(x, \sigma^2)\)</span>. Thus, the second column shown above, <code>cyl_encoded_var</code> is the expected value of <span class="math inline">\(\sigma^2\)</span>.</p>
<div id="classification-conjugate-encoding" class="section level3">
<h3 class="hasAnchor">
<a href="#classification-conjugate-encoding" class="anchor"></a>Classification Conjugate Encoding</h3>
<p>Changing the objective to “binary” in <code>target_encoder</code> makes no difference since it just calculates the mean of y, regardless if it is binary or fully continiuous. However, for <code>conjugate_encoder</code> this is not true since the likelihood used is specifically chosen to handle binary outcomes (a binomial).</p>
<p>For classification, the user must specify a list with two named arguments for <code>prior_params</code>; alpha and beta. These variables correspond to the parameters of a <a href="https://en.wikipedia.org/wiki/Beta_distribution">beta distribution.</a></p>
<p>Otherwise, the usage is exactly the same as above:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">prior_values &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">alpha =</span> <span class="dv">1</span>, <span class="dt">beta =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">encodings_conjugate &lt;-<span class="st"> </span><span class="kw"><a href="../reference/conjugate_encoder.html">conjugate_encoder</a></span>(</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">  <span class="dt">X_test =</span> mtcars_test,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">  <span class="dt">y =</span> mtcars_train<span class="op">$</span>vs,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">  <span class="dt">prior_params =</span> prior_values,</a>
<a class="sourceLine" id="cb10-8" data-line-number="8">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>),</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">  <span class="dt">objective =</span> <span class="st">"binary"</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; Joining, by = "cyl"</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"></a>
<a class="sourceLine" id="cb10-14" data-line-number="14">encodings_conjugate<span class="op">$</span>train <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(cyl_encoded) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span>(<span class="dt">cyl =</span> mtcars_train<span class="op">$</span>cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="st">  </span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/distinct.html">distinct</a></span>()</a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt;   cyl_encoded cyl</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; 1     0.15625   6</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; 2     0.31250   4</span></a>
<a class="sourceLine" id="cb10-21" data-line-number="21"><span class="co">#&gt; 3     0.03125   8</span></a></code></pre></div>
<p>Note that in this case, the target variable has changed to the binary variable <code>vs</code>. The column <code>cyl_encoded</code> is the expected value of the posterior distribution (also a beta).</p>
</div>
</div>
<div id="one-hot-encoding" class="section level2">
<h2 class="hasAnchor">
<a href="#one-hot-encoding" class="anchor"></a>One Hot Encoding</h2>
<p><strong>encodeR</strong> would not be complete without including the most popular method for encoding categorical features. This method creates k-1 columns of 0/1 indicator variables, where k is the number of categories. This is a completely uninformative method, but the syntax remains the same for consistency.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">ohe_encodings &lt;-<span class="st"> </span><span class="kw"><a href="../reference/onehot_encoder.html">onehot_encoder</a></span>(</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">  <span class="dt">X_train =</span> mtcars_train,</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">  <span class="dt">X_test =</span> mtcars_test,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">  <span class="dt">cat_columns =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cyl"</span>)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb11-7" data-line-number="7"></a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(ohe_encodings<span class="op">$</span>train)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;    mpg disp  hp drat    wt  qsec vs am gear carb cyl_6 cyl_8</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt; 1 21.0  160 110 3.90 2.620 16.46  0  1    4    4     1     0</span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; 2 21.0  160 110 3.90 2.875 17.02  0  1    4    4     1     0</span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; 3 22.8  108  93 3.85 2.320 18.61  1  1    4    1     0     0</span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; 4 21.4  258 110 3.08 3.215 19.44  1  0    3    1     1     0</span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 5 18.7  360 175 3.15 3.440 17.02  0  0    3    2     0     1</span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; 6 18.1  225 105 2.76 3.460 20.22  1  0    3    1     1     0</span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16">ohe_encodings<span class="op">$</span>test</a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt;    mpg disp  hp drat   wt qsec vs am gear carb cyl_6 cyl_8</span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; 1 15.0  301 335 3.54 3.57 14.6  0  1    5    8     0     1</span></a>
<a class="sourceLine" id="cb11-19" data-line-number="19"><span class="co">#&gt; 2 21.4  121 109 4.11 2.78 18.6  1  1    4    2     0     0</span></a></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#target-encoding">Target Encoding</a></li>
      <li><a href="#frequency-encoding">Frequency Encoding</a></li>
      <li><a href="#conjugate-encoding">Conjugate Encoding</a></li>
      <li><a href="#one-hot-encoding">One Hot Encoding</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Brayden Tang, Shiying Wang, Bronwyn Baillie, Robert Pimentel.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
